var editor;var ez;var _encrypting=null;var __timer_decryption;var __timer_encryption;var __timer_coloring;var __timer_total;$LAB.setGlobalDefaults({UseLocalXHR:true,AlwaysPreserveOrder:false,AllowDuplicates:true});$(function(){if(document.getElementById("content")){editor=CodeMirror.fromTextArea(document.getElementById("content"),{lineNumbers:true,matchBrackets:false,lineWrapping:false,readOnly:true,onChange:onCodeChange});editor.setOption("mode",$("#syntax").val());editor.focus()}$("#key").val(generateKey());$("#text").live("keydown",function(a){if(a.keyCode==13&&a.ctrlKey){$("#en").click()}});$("#usepassword").change(function(){if(this.checked){$("#typepassword").show()}else{$("#typepassword").hide()}});$("#text").bind("textchange",function(){if(_encrypting!=null){clearTimeout(_encrypting);_encrypting=null}_encrypting=setTimeout("$( '#result' ).val( encrypt( $( '#key' ).val(), $( '#text' ).val() ) ); _encrypting = null",500)});$("#new").bind("click",function(){$("#text").html("");$("#result").val("");$("#newpaste").slideDown()});$("#clone").bind("click",function(){$("#text").html(editor.getValue()).trigger("textchange");$("#newpaste").slideDown()});$("#tool-wrap").bind("click",function(){var a=$("#tool-wrap").is(":checked");if(a==1){$(".tool-wrap").addClass("tool-wrap-on");editor.setOption("lineWrapping",true)}else{$(".tool-wrap").removeClass("tool-wrap-on");editor.setOption("lineWrapping",false)}});$("#tool-numbers").bind("click",function(){var a=$("#tool-numbers").is(":checked");if(a==1){$(".tool-numbers").addClass("tool-numbers-on");editor.setOption("lineNumbers",true)}else{$(".tool-numbers").removeClass("tool-numbers-on");editor.setOption("lineNumbers",false)}});$("#tool-fullscreen").bind("click",function(){var a=$("#tool-fullscreen").is(":checked");if(a==1){$(".tool-fullscreen").addClass("tool-fullscreen-on");$("#holder").css("width","100%")}else{$(".tool-fullscreen").removeClass("tool-fullscreen-on");$("#holder").css("width","")}});enableHover()});var timeDiff={time:undefined,setStartTime:function(){d=new Date();this.time=d.getTime()},getDiff:function(){d=new Date();return d.getTime()-this.time}};function stringBreak(e,b){var a="";for(var c=0;c<e.length;c++){a+=e.charAt(c);if(((c+1)%b==0)&&(0<c)){a+="\n"}}return a}function generateKey(){var a="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";var c="";for(var b=1;b<25;b++){c+=a[Math.floor(Math.random()*a.length)]}return c}function enableHover(){$("#en").hover(function(){$("#result").show();$("#encrypttime").show();$("#result").focus()},function(){$("#result").hide();$("#encrypttime").hide();$("#text").focus()})}function onCodeChange(a,b){__timer_coloring=timeDiff.getDiff();$("#coloring").html("syntax: "+__timer_coloring+"ms,");__timer_total=(__timer_decryption+__timer_coloring);$("#totaltime").html("total: "+__timer_total+"ms")}function decrypt(a,c){$("#decrypting").show();$("#insertkey").hide();timeDiff.setStartTime();var b=ez.aes.decrypt(a,c);__timer_decryption=timeDiff.getDiff();timeDiff.setStartTime();$("#execute").html("decryption: "+__timer_decryption+"ms,");$(".cm-s-default").parent().show();$("#decrypting").hide();return b}function encrypt(a,b){timeDiff.setStartTime();var c=stringBreak(ez.aes.encrypt(a,b),96);__timer_encryption=timeDiff.getDiff();$("#encrypttime").html("encryption: "+__timer_encryption+"ms");return c}function requestData(b){var a=window.location.href;var f=window.location.hash;var c=a.indexOf(f)||a.length;var e=a.substr(0,c);$.ajax({url:e,type:"POST",dataType:"json",data:"&p="+b,cache:false,success:function(g){$("#data").val(g.data);$("#syntax").val(g.syntax);editor.setOption("mode",$("#syntax").val());if(f==""){$("#askpassword").hide();$("#insertkey").show();$("#typekey").focus()}else{$("#askpassword").hide();editor.setValue(decrypt(f.substring(1),$("#data").val()))}},error:function(){alert("bad password!")}})}function submitData(e){if($("#text").val()==""){return false}else{if(_encrypting==null&&$("#result").val()==""&&$("#text").val()!=""){ezcrypt(lib,function(){ez=this;$("#result").val(encrypt($("#key").val(),$("#text").val()))})}else{if(_encrypting!=null&&$("#text").val()!=""){setTimeout(submitData.bind(this,e),100);return false}}}$("#en").unbind("mouseenter mouseleave");$("#result").show();$("#encrypttime").show();var f=$("#result").val();f=encodeURIComponent(f);var c="";if($("#usepassword").is(":checked")){c=ez.sha($("#typepassword").val())}var a=$("#ttl option:selected").val();var b=$("#syntax option:selected").val();if(typeof(b)=="undefined"){b=$("#syntax").val()}$.ajax({url:e,type:"POST",dataType:"json",data:"&data="+f+"&p="+c+"&ttl="+a+"&syn="+b,cache:false,success:function(g){if(a==-100){}else{window.location=e+"p/"+g.id+"#"+$("#key").val()}},error:function(){enableHover();alert("error submitting form")}})};